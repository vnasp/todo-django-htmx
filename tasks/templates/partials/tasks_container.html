<div id="tasks-container" class="flex flex-col gap-6 w-full">
  <div class="flex flex-col items-end w-full">
    <button
      hx-on:click="htmx.removeClass(htmx.find('#offcanvas'), 'translate-x-full'); htmx.addClass(htmx.find('#offcanvas'), 'translate-x-0'); htmx.removeClass(htmx.find('#offcanvas-backdrop'), 'hidden')"
      class="btn bg-primary text-white"
    >
      + Agregar nueva tarea
    </button>

    <!-- Backdrop -->
    <div
      id="offcanvas-backdrop"
      class="fixed inset-0 bg-black/50 hidden z-40"
      hx-on:click="htmx.addClass(htmx.find('#offcanvas'), 'translate-x-full'); htmx.removeClass(htmx.find('#offcanvas'), 'translate-x-0'); htmx.addClass(htmx.find('#offcanvas-backdrop'), 'hidden')"
    ></div>

    <!-- Offcanvas panel -->
    <aside
      id="offcanvas"
      class="fixed inset-y-0 right-0 w-full max-w-md bg-slate-100 shadow-lg transform translate-x-full transition-transform duration-300 z-50"
    >
      <div class="p-6 h-full flex flex-col">
        <div class="flex items-center justify-between mb-4">
          <h3 class="text-lg font-semibold">Nueva tarea</h3>
          <button
            type="button"
            class="text-gray-600 hover:text-gray-800"
            hx-on:click="htmx.addClass(htmx.find('#offcanvas'), 'translate-x-full'); htmx.removeClass(htmx.find('#offcanvas'), 'translate-x-0'); htmx.addClass(htmx.find('#offcanvas-backdrop'), 'hidden')"
            aria-label="Cerrar"
          >
            ✕
          </button>
        </div>

        <form
          id="add-task-form"
          hx-post="{% url 'api_create_task' %}"
          hx-target="#tasks-container"
          hx-swap="outerHTML"
          hx-on::after-request="htmx.addClass(htmx.find('#offcanvas'), 'translate-x-full'); htmx.removeClass(htmx.find('#offcanvas'), 'translate-x-0'); htmx.addClass(htmx.find('#offcanvas-backdrop'), 'hidden')"
          class="mt-2 space-y-4 flex-1 overflow-y-auto"
        >
          {% csrf_token %}
          <div>
            <input
              type="text"
              name="title"
              placeholder="Título de la tarea"
              required
              class="w-full px-4 py-2 border border-gray-500 rounded-lg"
            />
          </div>
          <div>
            <textarea
              name="description"
              placeholder="Descripción (opcional)"
              rows="6"
              class="w-full px-4 py-2 border border-gray-500 rounded-lg"
            ></textarea>
          </div>
          <div class="flex gap-2 mt-auto">
            <button
              type="submit"
              class="flex-1 btn bg-primary text-white hover:opacity-90 transition-opacity"
            >
              Guardar
            </button>
            <button
              type="button"
              class="flex-1 btn bg-secondary text-white"
              hx-on:click="htmx.addClass(htmx.find('#offcanvas'), 'translate-x-full'); htmx.removeClass(htmx.find('#offcanvas'), 'translate-x-0'); htmx.addClass(htmx.find('#offcanvas-backdrop'), 'hidden')"
            >
              Cancelar
            </button>
          </div>
        </form>
      </div>
    </aside>
  </div>
  <div id="columns-board">{% include 'partials/all_columns.html' %}</div>
</div>
